{% extends "base.html" %}
{% load static %}

{% block title %}
{{ car.brand }} {{ car.model }} | Ø§Ù„ØªÙØ§ØµÙŠÙ„
{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'cars/css/car_detail.css' %}">
{% endblock %}

{% block content %}
<section class="car-detail-avito container mt-4">
    <div class="row">

   <!-- GALLERY -->
<div class="col-lg-7 col-md-12 mb-4">
    <div class="gallery-box">

        <div class="main-image">

            <!-- ğŸ”¢ Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØµÙˆØ± -->
            {% if car.images.all %}
            <span class="image-count">
                <i class='bx bx-images'></i>
                {{ car.images.count|add:1 }} ØµÙˆØ±
            </span>
            {% endif %}

            <!-- Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
            <img id="mainImage" src="{{ car.image.url }}" class="img-fluid">
        </div>

        {% if car.images.all %}
        <div class="thumbs">
            <img src="{{ car.image.url }}"
                 class="thumb active"
                 onclick="changeImage(this)">

            {% for img in car.images.all %}
            <img src="{{ img.image.url }}"
                 class="thumb"
                 onclick="changeImage(this)">
            {% endfor %}
        </div>
        {% endif %}

    </div>
</div>
<button class="nav-arrow left" onclick="prevImage()">
    <i class='bx bx-chevron-right'></i>
</button>
<button class="nav-arrow right" onclick="nextImage()">
    <i class='bx bx-chevron-left'></i>
</button>

        <!-- INFO -->
        <div class="col-lg-5 col-md-12">
            <div class="info-box">


        <h1 class="car-title">{{ car.brand }} {{ car.model }}</h1>

        <div class="price-box">
            <span class="price">{{ car.price }} Ø¯Ø±Ù‡Ù…</span>
        </div>

    <ul class="specs-grid">
    <li>
        <i class='bx bx-calendar'></i>
        <span>Ø³Ù†Ø© Ø§Ù„ØµÙ†Ø¹</span>
        <strong>{{ car.year }}</strong>
    </li>

    <li>
        <i class='bx bx-tachometer'></i>
        <span>Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ±Ø§Ø¬</span>
        <strong>{{ car.mileage }} ÙƒÙ…</strong>
    </li>

 <li>
    <i class='bx bx-cog'></i>
    <span>Ø§Ù„Ù…Ø­Ø±Ùƒ</span>
    <strong>{{ car.power }}</strong>
</li>

    <li>
        <i class='bx bx-gas-pump'></i>
        <span>Ø§Ù„ÙˆÙ‚ÙˆØ¯</span>
        <strong>{{ car.get_fuel_type_display }}</strong>
    </li>

    <li>
        <i class='bx bx-transfer-alt'></i>
        <span>Ù†Ø§Ù‚Ù„ Ø§Ù„Ø­Ø±ÙƒØ©</span>
        <strong>{{ car.get_transmission_display }}</strong>
    </li>

    <li>
        <i class='bx bx-car'></i>
        <span>Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨</span>
        <strong>{{ car.doors }}</strong>
    </li>

    <li>
        <i class='bx bx-check-shield'></i>
        <span>Ø§Ù„Ø­Ø§Ù„Ø©</span>
        <strong>{{ car.get_condition_display }}</strong>
    </li>
</ul>
{% if car.description %}
<div class="description-box">
    <h3>ÙˆØµÙ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</h3>
    <p>{{ car.description|linebreaks }}</p>
</div>
{% endif %}


        <div class="actions">
            {% if car.status == "available" %}
<a href="{% url 'book_car' car.id %}" class="btn-book">
    <i class='bx bx-calendar-check'></i>
    Ø§Ø­Ø¬Ø² Ø§Ù„Ø¢Ù†
</a>
            {% else %}
                <span class="badge reserved">ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</span>
            {% endif %}

            <a href="#"
   class="btn-whatsapp"
   onclick="sendWhatsAppMessage(event)">
   <i class='bx bxl-whatsapp'></i>
   Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
</a>

        </div>

    </div>

</section>

<script>
    function sendWhatsAppMessage(event) {
    event.preventDefault();

    const phone = "212754179212"; // Ø±Ù‚Ù…Ùƒ Ø¨Ø¯ÙˆÙ† +
    
    const message = `
Ù…Ø±Ø­Ø¨Ù‹Ø§ ğŸ‘‹
Ø£ÙˆØ¯ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©:

ğŸš— Ø§Ù„Ø³ÙŠØ§Ø±Ø©: {{ car.brand }} {{ car.model }}
ğŸ“… Ø³Ù†Ø© Ø§Ù„ØµÙ†Ø¹: {{ car.year }}
ğŸ’° Ø§Ù„Ø³Ø¹Ø±: {{ car.price }} Ø¯Ø±Ù‡Ù…
â›½ Ø§Ù„ÙˆÙ‚ÙˆØ¯: {{ car.get_fuel_type_display }}
âš™ï¸ Ù†Ø§Ù‚Ù„ Ø§Ù„Ø­Ø±ÙƒØ©: {{ car.get_transmission_display }}

ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†:
{{ request.build_absolute_uri }}

Ø´ÙƒØ±Ù‹Ø§ Ù„ÙƒÙ… ğŸŒŸ
    `;

    const url = "https://wa.me/" + phone + "?text=" + encodeURIComponent(message);

    window.open(url, "_blank");
}
function changeImage(element) {
    const mainImage = document.getElementById("mainImage");

    // ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    mainImage.src = element.src;

    // Ø¥Ø²Ø§Ù„Ø© active Ù…Ù† Ø§Ù„Ø¬Ù…ÙŠØ¹
    document.querySelectorAll(".thumb").forEach(img => {
        img.classList.remove("active");
    });

    // Ø¥Ø¶Ø§ÙØ© active Ù„Ù„ØµÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    element.classList.add("active");
}


let thumbs = document.querySelectorAll(".thumb");
let currentIndex = 0;

function showImage(index) {
    if (index < 0) index = thumbs.length - 1;
    if (index >= thumbs.length) index = 0;

    document.getElementById("mainImage").src = thumbs[index].src;
    thumbs.forEach(t => t.classList.remove("active"));
    thumbs[index].classList.add("active");

    currentIndex = index;
}

function nextImage() {
    showImage(currentIndex + 1);
}

function prevImage() {
    showImage(currentIndex - 1);
}


</script>

{% endblock %}
