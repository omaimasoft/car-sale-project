
{% extends "base.html" %}
{% load static %}

{% block title %}{{ offer.title }}{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'cars/css/offer_detail.css' %}">
{% endblock %}

{% block content %}

<section class="offer-detail-page" dir="rtl">
  <div class="offer-container">

    <!-- ================= IMAGES SECTION ================= -->
    <div class="offer-images">

      <div class="main-image">
        <img src="{{ offer.image.url }}" alt="{{ offer.title }}">

        {% if offer.discount_percent > 0 %}
        <span class="badge discount">
          -{{ offer.discount_percent }}%
        </span>
        {% endif %}

        {% if not offer.is_expired %}
        <span class="badge limited">
          Ø¹Ø±Ø¶ Ù…Ø­Ø¯ÙˆØ¯
        </span>
        {% endif %}
      </div>

      {% if offer.gallery.all %}
      <div class="gallery">
        {% for img in offer.gallery.all %}
        <img src="{{ img.image.url }}" alt="ØµÙˆØ±Ø© Ø¥Ø¶Ø§ÙÙŠØ©">
        {% endfor %}
      </div>
      {% endif %}
    </div>

    <!-- ================= INFO SECTION ================= -->
    <div class="offer-info">

      <h1 class="title">{{ offer.title }}</h1>
      <p class="car-name">{{ offer.car_name }}</p>

      <!-- RATING -->
      <div class="rating">
        {% for i in "12345" %}
          {% if forloop.counter <= offer.rating %}
            <span class="star filled">â˜…</span>
          {% else %}
            <span class="star">â˜…</span>
          {% endif %}
        {% endfor %}
      </div>

  <div class="prices">
  <span class="new-price">
    {{ offer.new_price }} <small>Ø¯Ø±Ù‡Ù…</small>
  </span>
  <span class="old-price">
    {{ offer.old_price }} <small>Ø¯Ø±Ù‡Ù…</small>
  </span>
</div>
<!-- IMAGE POPUP -->
<div id="imgPopup" class="img-popup">
  <span class="img-close">&times;</span>
  <img id="popupImg">
</div>


      <!-- TIME -->
      <div class="time-box {% if offer.is_expired %}expired{% endif %}">
        {% if not offer.is_expired %}
           Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: {{ offer.remaining_time }}
        {% else %}
           Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø¹Ø±Ø¶
        {% endif %}
      </div>

     <!-- DESCRIPTION -->
      <div class="description">
        <h3>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶</h3>
        <p>{{ offer.description }}</p>
      </div> 

      <!-- ACTIONS -->
      <div class="actions">
    <a href="#"
   class="btn whatsapp"
   onclick="sendOfferWhatsApp(event)">
          ÙˆØ§ØªØ³Ø§Ø¨
      </a>
      </div>
    </div>
  </div>
</section>
<script>
function sendOfferWhatsApp(event) {
    event.preventDefault();

    const phone = "212754179212"; // Ø±Ù‚Ù…Ùƒ Ø¨Ø¯ÙˆÙ† +

    const message = `
Ù…Ø±Ø­Ø¨Ù‹Ø§ ğŸ‘‹
Ø£ÙˆØ¯ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªØ§Ù„ÙŠ:

ğŸ”¥ {{ offer.title }}
ğŸš— Ø§Ù„Ø³ÙŠØ§Ø±Ø©: {{ offer.car_name }}

ğŸ’° Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯: {{ offer.new_price }} DH
{% if offer.discount_percent > 0 %}
ğŸ·ï¸ Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ®ÙÙŠØ¶: {{ offer.discount_percent }}%
ğŸ’µ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ…: {{ offer.old_price }} DH
{% endif %}

â³ Ø§Ù„Ø­Ø§Ù„Ø©: {% if offer.is_expired %}Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø¹Ø±Ø¶{% else %}Ø¹Ø±Ø¶ Ø³Ø§Ø±ÙŠ{% endif %}

ğŸ“ Ø§Ù„ÙˆØµÙ:
{{ offer.description|default:"-" }}

ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ø¹Ø±Ø¶:
{{ request.build_absolute_uri }}

Ø´ÙƒØ±Ù‹Ø§ Ù„ÙƒÙ… ğŸŒŸ
    `;

    const url = "https://wa.me/" + phone + "?text=" + encodeURIComponent(message);
    window.open(url, "_blank");
}
const popup = document.getElementById("imgPopup");
const popupImg = document.getElementById("popupImg");
const closeBtn = document.querySelector(".img-close");

/* Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
const mainImage = document.querySelector(".main-image img");
if (mainImage) {
  mainImage.addEventListener("click", () => {
    popup.style.display = "flex";
    popupImg.src = mainImage.src;
  });
}

/* Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…ØµØºÙ‘Ø±Ø© */
document.querySelectorAll(".gallery img").forEach(img => {
  img.addEventListener("click", () => {
    popup.style.display = "flex";
    popupImg.src = img.src;
  });
});

/* Ø¥ØºÙ„Ø§Ù‚ */
closeBtn.onclick = () => popup.style.display = "none";
popup.onclick = (e) => {
  if (e.target === popup) popup.style.display = "none";
};
</script>

{% endblock %}
